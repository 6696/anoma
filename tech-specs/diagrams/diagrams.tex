\documentclass[acmsmall]{acmart}
% clear acmtog.cls footer settings
\fancyfoot{}
\setcopyright{none}
\renewcommand\footnotetextcopyrightpermission[1]{}
\pagestyle{plain}
%remove reference format
\settopmatter{printacmref=false}
\numberwithin{figure}{subsection}
%
\usepackage{hyperref}
\usepackage{listings}
\usepackage{fancyvrb}
\usepackage{tikz} 

\DefineVerbatimEnvironment{code}{Verbatim}{fontsize=\small}
\begin{document}

\title{Spec Diagrams}

\author{Heliax Team}

\maketitle
\thispagestyle{empty}
\tableofcontents
\clearpage

\section{ABCI++}

\usetikzlibrary{fit}
\begin{tikzpicture}[node distance={14mm}, thick, main/.style = {draw, rectangle}] 
\node[main] (1) {Propose}; 
\node[main] (2) [below of=1] {Vote}; 
\node[main] (3) [below of=2] {Finalize Commit}; 
\node[main, scale=1.5] (4) [below of=3] {State Machine}; 
\draw[->] (1) -- node[midway, right]{} (2); 
\draw[->] (2) -- node[midway, right] {Wait for enough votes} (3); 
\draw[->] (3) -- node[midway, right] {Finalize Block} (4); 

\draw[<->] (1) (1.west) -- node[left=3.6em, above=0.1em]{Process proposal phase} ++(-100pt, 0pt) |- (4); 
\draw[<->] (2) (2.west) --  node[left=3.6em, above=0.1em]{Vote Extension} ++(-50pt, 0pt) |-  (4); 

\draw [->] (3) |- ([shift={(30mm,0mm)}]3.east) -- node[midway, right] {Wait for next proposal}  ([shift={(36mm,5mm)}]1.north east) -| node[above=1em, right=2em]{mempool.getblock()} (1);

\node[draw,dotted,fit=(1) (2) (3), label={[xshift=0mm]left:{}}] {};
\node[draw,dotted,fit=(1), label={[xshift=0mm]right:{(Block proposer only)}}] {};

\end{tikzpicture} 



\subsection{ABCI (old)}

\usetikzlibrary{fit}
\begin{tikzpicture}[node distance={14mm}, thick, main/.style = {draw, rectangle}] 
\node[main] (1) {Propose}; 
\node[main] (2) [below of=1] {Prevote}; 
\node[main] (3) [below of=2] {Precommit}; 
\node[main] (4) [below of=3] {Finalize Commit}; 
\node[main, scale=1.5] (5) [below of=4] {State Machine}; 
\draw[->] (1) -- node[midway, right]{} (2); 
\draw[->] (2) -- node[midway, right] {Wait for 2/3 prevotes} (3); 
\draw[->] (3) -- node[midway, right] {Wait for 2/3 precommits} (4); 
\draw[->] (4) -- node[midway, right] {BeginBlock, DeliverTxs, EndBlock} (5); 
\draw [->] (4) |- ([shift={(30mm,0mm)}]4.east) -- node[midway, right] {Wait for next proposal}  ([shift={(36mm,5mm)}]1.north east) -| node[above=1em, right=2em]{mempool.getblock()} (1);
\node[draw,dotted,fit=(1) (2) (3) (4), label={[xshift=0mm]left:{Tendermint Core}}] {};
\node[draw,dotted,fit=(1), label={[xshift=0mm]right:{(Block proposer only)}}] {};
\end{tikzpicture} 



\section{DKG}


\usetikzlibrary{positioning}
\begin{tikzpicture}[node distance={14mm}, thick, main/.style = {draw, rectangle}] 
\node[main] (1) {Init}; 
\node[main] (2) [below of=1] {Dealt}; 
\node[main] (3) [below of=2] {Shared}; 
\node[main] (4) [below=18mm of 3] {Aggregated}; 
\node[main] (5) [below=18mm of 4] {Success}; 
\node[main] (6) [right=30mm of 4] {Invalid}; 
\draw[->, dashed] (1) -- node[midway, right] {\textbf{deal} (by > (2/3) of validators)} (2); 
\draw[->, dotted] (2) -- node[midway, right] {\textit{generate\_transcript} (internally)} (3); 
\draw[->] (3) -- node[midway, left] {\textbf{aggregate} (by block proposer)} (4); 
\draw[->, dashed] (4) -- node[midway, right] {\textbf{check} (by > (2/3) of validators)} (5);
\draw[->] (4) -- node[midway, above] {\textbf{complain}} (6); 
\draw[->] (3) -- node[right, above=3mm] {\textbf{complain}} (6); 

\end{tikzpicture} 


\end{document}